<!DOCTYPE HTML>
<html>
<head>  
<meta charset="UTF-8">
<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script>
var newdata = amzn = fb = googl = msft = [];
window.onload = function () {
	var dataPoints = [];
	function getDateandClosing(stocks) {
		var xandy = []
		for (let i = 0; i < stocks.length; i++) {
			xandy.push({x: stocks[i].Date, y: stocks[i].Closing})
		}
		return xandy;
	}
	function getDataPointsFromCSV(csv) {
		var dataPoints = csvLines = points = [];
		csvLines = csv.split(/[\r?\n|\r|\n]+/);         
			
		for (var i = 1; i < csvLines.length; i++)
			if (csvLines[i].length > 0) {
				points = csvLines[i].split(",");
				dataPoints.push({ 
					Date: parseFloat(points[0]), 
					Stock: points[1],	
					Closing: parseFloat(points[2])
				});
			}
		return dataPoints;
	}
	$.ajax({
		async: false,
		url: 'stocks-csv.txt',
		dataType: 'text',
		success: function(data) {
			dataPoints = getDataPointsFromCSV(data)
			console.log(dataPoints)
			amzn = dataPoints.filter(dat => dat.Stock == "AMZN")
			fb = dataPoints.filter(dat => dat.Stock == "FB")
			googl = dataPoints.filter(dat => dat.Stock == "GOOGL")
			msft = dataPoints.filter(dat => dat.Stock == "MSFT")
		}
	})
	console.log(amzn)
var chart = new CanvasJS.Chart("chartContainer", {
	title: {
		text: "Stock Prices Over 10 Days"
	},
	axisY2: {
		title: "Closing Price",
		prefix: "$",
	},
	toolTip: {
		shared: true
	},
	legend: {
		cursor: "pointer",
		verticalAlign: "top",
		horizontalAlign: "center",
		dockInsidePlotArea: true,
		itemclick: toogleDataSeries
	},
	data: [{
		type:"line",
		axisYType: "secondary",
		name: "Amazon",
		showInLegend: true,
		markerSize: 0,
		dataPoints: getDateandClosing(amzn)
	},
	{
		type: "line",
		axisYType: "secondary",
		name: "Facebook",
		showInLegend: true,
		markerSize: 0,
		yValueFormatString: "$#,###",
		dataPoints: getDateandClosing(fb)
	},
	{
		type: "line",
		axisYType: "secondary",
		name: "Google",
		showInLegend: true,
		markerSize: 0,
		yValueFormatString: "$#,###",
		dataPoints: getDateandClosing(googl)
	},
	{
		type: "line",
		axisYType: "secondary",
		name: "Microsoft",
		showInLegend: true,
		markerSize: 0,
		yValueFormatString: "$#,###",
		dataPoints: getDateandClosing(msft)
	}
]
});
chart.render();

function toogleDataSeries(e){
	if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
		e.dataSeries.visible = false;
	} else{
		e.dataSeries.visible = true;
	}
	chart.render();
}

}
</script>
</head>
<body>
<div id="chartContainer" style="height: 370px; max-width: 920px; margin: 0px auto;"></div>
<script src="canvasjs.min.js"></script>
</body>
</html>